# Проект системы определения возраста по камере

## Общее описание

Проект представляет собой веб-приложение для определения возраста человека с помощью компьютерного зрения через веб-камеру. Основная цель системы - проверка возраста для контроля доступа к товарам с возрастным ограничением (18+).

## Технический стек

- **Фронтенд**: HTML, CSS, JavaScript (ванильный)
- **Библиотеки компьютерного зрения**:
  - TensorFlow.js - для вычислений нейронных сетей
  - Face-API.js - для распознавания лиц и определения возраста
- **Модели**:
  - SSD MobileNet - для детекции лиц
  - AgeGenderNet - для определения возраста

## Основные функции

1. **Захват видео с веб-камеры** и отображение его на экране
2. **Детекция лица** в видеопотоке в реальном времени
3. **Определение возраста** по лицу с применением нейронной сети
4. **Стабилизация данных** - усреднение результатов определения возраста для повышения точности
5. **Проверка возраста** на соответствие установленному порогу (18 лет)
6. **Вывод результата** проверки с визуальной индикацией (разрешено/запрещено)
7. **Сохранение статуса возраста** для программного доступа
8. **Адаптивная производительность** - автоматическая настройка под мощность устройства

## Архитектура приложения

### Основные компоненты

- **app.js** - главный файл с логикой работы приложения 
- **index.html** - структура пользовательского интерфейса и загрузчик скриптов
- **styles.css** - стили пользовательского интерфейса
- **/models** - директория с предобученными моделями:
  - **/face_api** - модели для Face-API.js (ssd_mobilenetv1_model.bin, age_gender_model.bin и др.)
- **/js/libs** - директория с библиотеками:
  - tf.min.js - TensorFlow.js
  - face-api.min.js - Face-API.js

### Ключевые переменные и константы

- `AGE_VERIFICATION_THRESHOLD` - порог возраста для проверки (18 лет)
- `AGE_HISTORY_LENGTH` - количество сохраняемых значений для стабилизации возраста
- `FACE_API_MODEL_URL` - путь к директории с моделями Face-API
- `performanceConfig` - настройки производительности для разных устройств
- `modelsLoadedSuccessfully` - флаг успешной загрузки моделей
- `window.ageStatus` и `window.ageVerificationStatus` - глобальные переменные для хранения результата проверки возраста

### Основные функции

- `loadModels()` - загрузка моделей распознавания лиц и возраста
- `startWebcam()` - инициализация и запуск веб-камеры
- `detectAgeAndGender()` - обнаружение лица и определение возраста
- `smoothAge()` - стабилизация значений возраста через усреднение
- `confirmAge()` - подтверждение и фиксация определенного возраста
- `updateAgeStatusElement()` - обновление визуального элемента с результатом проверки
- `checkDevicePerformance()` - определение производительности устройства
- `togglePerformanceMode()` - переключение между режимами производительности

## Пользовательский интерфейс

Интерфейс содержит следующие элементы:
- Видео с веб-камеры
- Канвас для отображения рамки детекции
- Кнопки управления:
  - Загрузка моделей (добавлена для решения проблем с инициализацией)
  - Запуск камеры
  - Остановка камеры
  - Перекалибровка возраста
  - Подтверждение возраста
  - Переключение режима производительности
- Информационные элементы:
  - Статус определения возраста
  - Определенный возраст
  - Вердикт о возрасте (разрешено/запрещено)
  - Визуальный индикатор статуса проверки
  - Индикатор режима производительности

## Рабочий процесс

1. Загрузка приложения и автоматическая инициализация TensorFlow.js и Face-API.js
2. Загрузка моделей (автоматически или по нажатию на кнопку "Загрузить модели")
3. Пользователь нажимает кнопку "Запустить камеру" (доступно только после загрузки моделей)
4. Система обнаруживает лицо в кадре и определяет возраст
5. После стабилизации возраста, пользователь может нажать "Подтвердить возраст"
6. Система сравнивает возраст с порогом 18 лет и выводит результат
7. Результат сохраняется в глобальных переменных и отображается визуально
8. Результат проверки: "18+" или "Младше 18 лет"

## Особенности и ограничения

1. Требуется разрешение для доступа к веб-камере
2. Для корректной работы необходимо хорошее освещение
3. Точность определения возраста зависит от качества камеры и условий освещения
4. Приложение работает только в браузерах с поддержкой WebGL и API для работы с камерой
5. Для доступа к веб-камере рекомендуется использовать HTTPS
6. Необходима поддержка JavaScript ES6+
7. Возможны задержки при первой загрузке моделей (5-10 секунд)

## Статус проверки возраста

Результат проверки возраста может быть получен через:
1. **Визуальные индикаторы на странице** - текст и цветовые обозначения результата
2. **Глобальные переменные JavaScript**:
   - `window.ageStatus` или `window.ageVerificationStatus` содержат одно из значений:
     - "18+" - если возраст больше или равен порогу (18 лет)
     - "Младше 18 лет" - если возраст меньше порога
3. **DOM элемент с ID `ageStatusData`** - визуальный индикатор с информацией о статусе

## Решение известных проблем

### Загрузка моделей

1. **Проблема с путем к моделям**: Путь к моделям должен быть указан как `models/face_api` (без точки в начале).
2. **Ошибка очистки кэша TensorFlow**: Добавлена проверка наличия методов перед их вызовом.
3. **Модели не загружаются до использования**: Добавлена проверка загрузки моделей перед запуском камеры.
4. **Конфликт при асинхронной загрузке скриптов**: Улучшена обработка событий загрузки в `index.html`.

### Отображение и производительность

1. **Ошибка отрисовки рамки**: Добавлены локальные переменные для координат в функции `renderFrame`.
2. **Производительность на слабых устройствах**: Реализовано определение мощности устройства и адаптивные настройки.
3. **Плавное обновление UI**: Разделены процессы детекции и отрисовки для повышения плавности.

## Дальнейшее развитие

Возможные направления улучшения:
1. Улучшение точности определения возраста
2. Добавление авторизации и логирования результатов проверок
3. Добавление API для интеграции с другими системами
4. Оптимизация для мобильных устройств
5. Улучшение UX/UI интерфейса
6. Дополнительная оптимизация загрузки моделей (сжатие, квантизация)
7. Добавление режима работы офлайн (PWA)
8. Мультиязычная поддержка 